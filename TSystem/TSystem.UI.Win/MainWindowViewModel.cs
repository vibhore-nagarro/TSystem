using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.IO;
using System.Linq;
using System.Security.Cryptography.X509Certificates;
using System.Text;
using TSystem.Core;
using TSystem.Core.Events;
using TSystem.Entities;
using TSystem.Entities.Enums;

namespace TSystem.UI.Win
{
    public class Analysis
    {
        public Signal Signal { get; set; }
        public decimal TradePL { get; set; }
        public decimal PL { get; set; }
    }

    public class MainWindowViewModel : INotifyPropertyChanged
    {
        public event PropertyChangedEventHandler PropertyChanged;
        private void OnPropertyChanged(string propertyName)
        {
            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
        }

        public ObservableCollection<Analysis> Signals { get; set; } = new ObservableCollection<Analysis>();

        public void OnLoad()
        {
            LoadData();

            Analyzer analyzer = new Analyzer(715267);

            //IEnumerable<string> quotes = File.ReadAllLines(@"D:\StockData\Nifty 50.csv").Skip(1);
            //IEnumerable<string> quotes = File.ReadAllLines(@"D:\StockData\USD_INR Aug.csv").Skip(1).Reverse();
            //foreach (string quote in quotes)
            var candles = LoadData();
            candles.RemoveAll(x => x.TimeStamp.Month < 3 || x.TimeStamp.Year == 2019);
            foreach (Candle candle in candles)
            {
                //string[] fields = quote.Split(',');
                //DateTime timeStamp = DateTime.ParseExact(fields[0], "MMM dd yyyy", null);
                //decimal close = decimal.Parse(fields[1].Trim('\"'));
                //decimal open = decimal.Parse(fields[2].Trim('\"'));
                //decimal high = decimal.Parse(fields[3].Trim('\"'));
                //decimal low = decimal.Parse(fields[4].Trim('\"'));

                //Candle candle = new Candle()
                //{
                //    Open = open,
                //    High = high,
                //    Low = low,
                //    Close = close,
                //    TimeStamp = timeStamp
                //};
                analyzer.Model.LTP = candle.Close;
                candle.Index = (uint)analyzer.Model.Candles.Count;
                analyzer.Model.Candles.Add(candle);
                analyzer.BuildHekinAshiCandle();

                Signal signal = analyzer.BackTest();
                if (signal.SignalType != SignalType.None)
                {
                    Signals.Add(new Analysis()
                    {
                        Signal = signal,
                        TradePL = analyzer.PerformanceModel.LastTradePL,
                        PL = analyzer.PerformanceModel.PL,
                    });
                }
            }
            analyzer.DumpOutput();
        }

        private List<Candle> LoadData()
        
        {
            string response = @"{
  'candles': [
    [ '2019-08-28T00:00:00+0530', 74.6, 74.78, 74.6, 74.74, 212, 211 ],
    [ '2019-08-29T00:00:00+0530', 74.8, 75.02, 74.1, 74.8, 1532, 1282 ],
    [ '2019-08-30T00:00:00+0530', 74.6, 74.6, 74.25, 74.2625, 63, 1340 ],
    [ '2019-09-03T00:00:00+0530', 74.515, 75.2775, 74.515, 75.25, 1371, 2254 ],
    [ '2019-09-04T00:00:00+0530', 75.1025, 75.195, 74.815, 75, 406, 2440 ],
    [ '2019-09-05T00:00:00+0530', 74.67, 74.87, 74.67, 74.7375, 170, 2447 ],
    [ '2019-09-06T00:00:00+0530', 74.7025, 74.7075, 74.5, 74.6575, 789, 2481 ],
    [ '2019-09-09T00:00:00+0530', 74.65, 74.6925, 74.5, 74.6875, 163, 2331 ],
    [ '2019-09-11T00:00:00+0530', 74.77, 74.77, 74.525, 74.635, 515, 2622 ],
    [ '2019-09-12T00:00:00+0530', 74.44, 74.44, 74.0625, 74.1575, 549, 2792 ],
    [ '2019-09-13T00:00:00+0530', 73.94, 74.1, 73.8525, 73.9, 433, 3144 ],
    [ '2019-09-16T00:00:00+0530', 74.25, 75.4975, 74.2025, 74.6225, 574, 3261 ],
    [ '2019-09-17T00:00:00+0530', 74.86, 74.95, 74.725, 74.8675, 308, 3542 ],
    [ '2019-09-18T00:00:00+0530', 74.5, 74.5, 74.15, 74.2225, 519, 3268 ],
    [ '2019-09-19T00:00:00+0530', 74.15, 74.34, 74.015, 74.3, 785, 3879 ],
    [ '2019-09-20T00:00:00+0530', 74.1, 74.1, 73.74, 73.86, 407, 3928 ],
    [ '2019-09-23T00:00:00+0530', 73.765, 73.9, 73.76, 73.7625, 119, 3947 ],
    [ '2019-09-24T00:00:00+0530', 73.68, 73.875, 73.64, 73.84, 43, 3952 ],
    [ '2019-09-25T00:00:00+0530', 73.9, 73.91, 73.8, 73.87, 167, 4017 ],
    [ '2019-09-26T00:00:00+0530', 72.8075, 73.75, 72.8075, 73.62, 133, 4087 ],
    [ '2019-09-27T00:00:00+0530', 73.6, 73.695, 73.31, 73.31, 220, 4117 ],
    [ '2019-10-01T00:00:00+0530', 73.445, 73.76, 73.4375, 73.76, 268, 3971 ],
    [ '2019-10-03T00:00:00+0530', 73.88, 73.9, 73.54, 73.54, 68, 3941 ],
    [ '2019-10-04T00:00:00+0530', 73.35, 73.61, 73.35, 73.61, 53, 3961 ],
    [ '2019-10-07T00:00:00+0530', 73.62, 73.62, 73.54, 73.55, 18, 3945 ],
    [ '2019-10-09T00:00:00+0530', 73.7, 73.7425, 73.4925, 73.5, 122, 3948 ],
    [ '2019-10-10T00:00:00+0530', 73.585, 73.65, 73.4875, 73.625, 92, 3913 ],
    [ '2019-10-11T00:00:00+0530', 73.48, 73.595, 73.4375, 73.5025, 75, 3897 ],
    [ '2019-10-14T00:00:00+0530', 73.36, 73.65, 73.36, 73.63, 271, 3900 ],
    [ '2019-10-15T00:00:00+0530', 73.72, 73.95, 73.715, 73.92, 153, 4019 ],
    [ '2019-10-16T00:00:00+0530', 74.01, 74.1, 73.85, 73.85, 107, 4084 ],
    [ '2019-10-17T00:00:00+0530', 73.74, 73.83, 73.525, 73.525, 10, 4086 ],
    [ '2019-10-18T00:00:00+0530', 73.5, 73.57, 73.49, 73.57, 55, 4086 ],
    [ '2019-10-22T00:00:00+0530', 73.3675, 73.3675, 73.23, 73.3, 242, 4079 ],
    [ '2019-10-23T00:00:00+0530', 73.35, 73.35, 73.205, 73.205, 11, 4083 ],
    [ '2019-10-24T00:00:00+0530', 73.0525, 73.32, 73.0525, 73.32, 155, 4073 ],
    [ '2019-10-25T00:00:00+0530', 73.17, 73.2925, 73.16, 73.1675, 27, 4094 ],
    [ '2019-10-27T00:00:00+0530', 73.16, 73.23, 73.16, 73.2275, 26, 4068 ],
    [ '2019-10-29T00:00:00+0530', 72.97, 73.15, 72.85, 73.075, 188, 4067 ],
    [ '2019-10-30T00:00:00+0530', 73.235, 73.2375, 73.0325, 73.0925, 12, 4072 ],
    [ '2019-10-31T00:00:00+0530', 72.925, 73.26, 72.925, 73.18, 38, 4056 ],
    [ '2019-11-01T00:00:00+0530', 73.1425, 73.1425, 73.1425, 73.1425, 1, 4055 ],
    [ '2019-11-04T00:00:00+0530', 73.15, 73.15, 73.15, 73.15, 5, 4055 ],
    [ '2019-11-05T00:00:00+0530', 73, 73, 72.995, 72.995, 2, 4057 ],
    [ '2019-11-06T00:00:00+0530', 72.9775, 73.26, 72.9775, 73.26, 30, 4044 ],
    [ '2019-11-07T00:00:00+0530', 73.4975, 73.4975, 73.1125, 73.1125, 16, 4035 ],
    [ '2019-11-08T00:00:00+0530', 73.36, 73.4925, 73.2475, 73.3275, 108, 4135 ],
    [ '2019-11-11T00:00:00+0530', 73.36, 73.6, 73.36, 73.545, 834, 4486 ],
    [ '2019-11-13T00:00:00+0530', 73.7, 74.1875, 73.69, 74.09, 255, 4545 ],
    [ '2019-11-14T00:00:00+0530', 74.195, 74.195, 73.9875, 74.02, 21, 4544 ],
    [ '2019-11-15T00:00:00+0530', 73.765, 73.87, 73.6125, 73.86, 611, 5093 ],
    [ '2019-11-18T00:00:00+0530', 73.86, 73.86, 73.86, 73.86, 0, 5093 ],
    [ '2019-11-19T00:00:00+0530', 73.91, 73.91, 73.75, 73.75, 3, 5095 ],
    [ '2019-11-20T00:00:00+0530', 73.865, 73.865, 73.865, 73.865, 1, 5095 ],
    [ '2019-11-21T00:00:00+0530', 73.8, 73.9125, 73.71, 73.725, 5, 5095 ],
    [ '2019-11-22T00:00:00+0530', 73.6675, 73.775, 73.6675, 73.7575, 152, 5095 ],
    [ '2019-11-25T00:00:00+0530', 74, 74, 73.635, 73.845, 8, 5093 ],
    [ '2019-11-26T00:00:00+0530', 73.7575, 73.7975, 73.48, 73.59, 69, 5037 ],
    [ '2019-11-27T00:00:00+0530', 73.4975, 73.4975, 73.2325, 73.2325, 96, 5035 ],
    [ '2019-11-28T00:00:00+0530', 73.49, 73.4975, 73.325, 73.4975, 18, 5047 ],
    [ '2019-11-29T00:00:00+0530', 73.565, 73.7125, 73.565, 73.695, 54, 5090 ],
    [ '2019-12-02T00:00:00+0530', 73.695, 73.72, 73.58, 73.6175, 57, 5085 ],
    [ '2019-12-03T00:00:00+0530', 73.505, 73.7025, 73.505, 73.7025, 57, 5030 ],
    [ '2019-12-04T00:00:00+0530', 73.645, 73.645, 73.62, 73.62, 4, 5026 ],
    [ '2019-12-05T00:00:00+0530', 73.45, 73.5975, 73.2525, 73.2875, 100, 4987 ],
    [ '2019-12-06T00:00:00+0530', 73.3, 73.4425, 73.29, 73.35, 121, 4900 ],
    [ '2019-12-09T00:00:00+0530', 73.125, 73.205, 73.05, 73.075, 611, 4295 ],
    [ '2019-12-10T00:00:00+0530', 73.065, 73.065, 72.9, 72.99, 249, 4349 ],
    [ '2019-12-11T00:00:00+0530', 72.81, 72.9575, 72.81, 72.87, 453, 4199 ],
    [ '2019-12-12T00:00:00+0530', 72.71, 72.8, 72.61, 72.8, 37, 4223 ],
    [ '2019-12-13T00:00:00+0530', 72.54, 72.9575, 72.54, 72.7925, 360, 4274 ],
    [ '2019-12-16T00:00:00+0530', 72.9, 73.0725, 72.885, 73.0725, 11, 4278 ],
    [ '2019-12-17T00:00:00+0530', 72.93, 72.93, 72.93, 72.93, 1, 4278 ],
    [ '2019-12-18T00:00:00+0530', 72.93, 73.13, 72.93, 73.075, 591, 4606 ],
    [ '2019-12-19T00:00:00+0530', 73, 73.2, 73, 73.11, 423, 5003 ],
    [ '2019-12-20T00:00:00+0530', 73.095, 73.1275, 73.095, 73.1275, 26, 4979 ],
    [ '2019-12-23T00:00:00+0530', 73.12, 73.15, 73.12, 73.15, 314, 5277 ],
    [ '2019-12-24T00:00:00+0530', 73.15, 73.2, 73.09, 73.2, 362, 5606 ],
    [ '2019-12-26T00:00:00+0530', 73.16, 73.2675, 73.1075, 73.14, 86, 5664 ],
    [ '2019-12-27T00:00:00+0530', 73.1025, 73.3975, 73.0875, 73.25, 1033, 6077 ],
    [ '2019-12-30T00:00:00+0530', 73.17, 73.245, 73.17, 73.245, 2, 6077 ],
    [ '2019-12-31T00:00:00+0530', 73.16, 73.235, 73.1575, 73.22, 205, 6080 ],
    [ '2020-01-01T00:00:00+0530', 73.23, 73.24, 73.1225, 73.135, 8, 6084 ],
    [ '2020-01-02T00:00:00+0530', 73.1575, 73.2475, 73.1525, 73.225, 50, 6086 ],
    [ '2020-01-03T00:00:00+0530', 73.5775, 73.64, 73.3025, 73.64, 339, 6411 ],
    [ '2020-01-06T00:00:00+0530', 73.83, 73.9525, 73.8225, 73.8225, 83, 6449 ],
    [ '2020-01-07T00:00:00+0530', 73.55, 73.74, 73.5425, 73.64, 33, 6470 ],
    [ '2020-01-08T00:00:00+0530', 73.88, 73.9575, 73.65, 73.65, 7, 6467 ],
    [ '2020-01-09T00:00:00+0530', 73.44, 73.44, 73.05, 73.065, 298, 6409 ],
    [ '2020-01-10T00:00:00+0530', 73.2475, 73.2475, 72.655, 72.6725, 176, 6438 ],
    [ '2020-01-13T00:00:00+0530', 72.66, 72.735, 72.5825, 72.665, 187, 6442 ],
    [ '2020-01-14T00:00:00+0530', 72.6, 72.75, 72.6, 72.64, 297, 6194 ],
    [ '2020-01-15T00:00:00+0530', 72.8, 72.8, 72.66, 72.68, 534, 5884 ],
    [ '2020-01-16T00:00:00+0530', 72.57, 72.72, 72.52, 72.72, 71, 5916 ],
    [ '2020-01-17T00:00:00+0530', 72.775, 72.825, 72.775, 72.825, 15, 5925 ],
    [ '2020-01-20T00:00:00+0530', 72.825, 72.825, 72.825, 72.825, 0, 5925 ],
    [ '2020-01-21T00:00:00+0530', 72.9, 72.9525, 72.8975, 72.92, 33, 5913 ],
    [ '2020-01-22T00:00:00+0530', 72.85, 72.9075, 72.85, 72.865, 9, 5907 ],
    [ '2020-01-23T00:00:00+0530', 72.83, 72.915, 72.83, 72.91, 48, 5926 ],
    [ '2020-01-24T00:00:00+0530', 72.91, 72.9325, 72.91, 72.9325, 6, 5930 ],
    [ '2020-01-27T00:00:00+0530', 71.715, 73.14, 71.715, 73.085, 612, 6072 ],
    [ '2020-01-28T00:00:00+0530', 73, 73, 72.96, 72.96, 12, 6084 ],
    [ '2020-01-29T00:00:00+0530', 72.86, 72.9625, 72.81, 72.9425, 1063, 6190 ],
    [ '2020-01-30T00:00:00+0530', 73.01, 73.225, 73.01, 73.12, 796, 6820 ],
    [ '2020-01-31T00:00:00+0530', 73.03, 73.0725, 72.99, 73.0475, 123, 6782 ],
    [ '2020-02-03T00:00:00+0530', 73.215, 73.255, 73.115, 73.115, 95, 6842 ],
    [ '2020-02-04T00:00:00+0530', 72.8275, 72.885, 72.73, 72.8675, 539, 6387 ],
    [ '2020-02-05T00:00:00+0530', 72.81, 72.85, 72.8, 72.825, 272, 6502 ],
    [ '2020-02-06T00:00:00+0530', 72.8525, 72.8525, 72.69, 72.735, 122, 6533 ],
    [ '2020-02-07T00:00:00+0530', 72.785, 72.955, 72.785, 72.8925, 698, 6604 ],
    [ '2020-02-10T00:00:00+0530', 72.85, 72.85, 72.74, 72.7475, 262, 6675 ],
    [ '2020-02-11T00:00:00+0530', 72.65, 72.78, 72.65, 72.77, 229, 6701 ],
    [ '2020-02-12T00:00:00+0530', 72.71, 72.805, 72.68, 72.76, 89, 6765 ],
    [ '2020-02-13T00:00:00+0530', 72.78, 72.8525, 72.705, 72.7125, 524, 6917 ],
    [ '2020-02-14T00:00:00+0530', 72.7125, 72.755, 72.705, 72.72, 107, 6929 ],
    [ '2020-02-17T00:00:00+0530', 72.7125, 72.74, 72.605, 72.615, 25, 6937 ],
    [ '2020-02-18T00:00:00+0530', 72.72, 72.82, 72.7175, 72.8125, 408, 7236 ],
    [ '2020-02-20T00:00:00+0530', 73, 73.01, 72.8125, 72.905, 1723, 8287 ],
    [ '2020-02-24T00:00:00+0530', 73.125, 73.25, 73.0575, 73.2325, 1738, 9070 ],
    [ '2020-02-25T00:00:00+0530', 73.06, 73.19, 73.055, 73.14, 1129, 9243 ],
    [ '2020-02-26T00:00:00+0530', 73.005, 73.05, 72.855, 72.9275, 419, 9532 ],
    [ '2020-02-27T00:00:00+0530', 72.9225, 72.925, 72.8275, 72.8675, 2215, 9446 ],
    [ '2020-02-28T00:00:00+0530', 73.15, 73.55, 73.085, 73.445, 4733, 12265 ],
    [ '2020-03-02T00:00:00+0530', 73.4, 74.05, 73.34, 73.93, 3975, 13355 ],
    [ '2020-03-03T00:00:00+0530', 73.74, 74.665, 73.7275, 74.56, 16470, 20632 ],
    [ '2020-03-04T00:00:00+0530', 74.6, 74.97, 74.2675, 74.5575, 5639, 23326 ],
    [ '2020-03-05T00:00:00+0530', 74.7075, 74.78, 74.33, 74.575, 1184, 23167 ],
    [ '2020-03-06T00:00:00+0530', 75.2325, 75.28, 74.78, 75.065, 4210, 22875 ],
    [ '2020-03-09T00:00:00+0530', 75.2475, 75.46, 75.1975, 75.35, 1151, 22897 ],
    [ '2020-03-11T00:00:00+0530', 75.1575, 75.3, 74.84, 74.875, 4429, 25690 ],
    [ '2020-03-12T00:00:00+0530', 75.5, 75.6125, 75.125, 75.5, 2510, 24639 ],
    [ '2020-03-13T00:00:00+0530', 76.2475, 76.2475, 75.105, 75.22, 1284, 24811 ],
    [ '2020-03-16T00:00:00+0530', 75.39, 75.6475, 75.39, 75.5775, 1504, 24894 ],
    [ '2020-03-17T00:00:00+0530', 75.45, 75.6625, 75.18, 75.6025, 441, 24824 ],
    [ '2020-03-18T00:00:00+0530', 75.4, 75.73, 75.25, 75.6275, 726, 24693 ],
    [ '2020-03-19T00:00:00+0530', 76.3, 76.7525, 76.12, 76.5575, 2903, 24565 ],
    [ '2020-03-20T00:00:00+0530', 76.3225, 76.73, 76.2, 76.715, 2017, 24878 ],
    [ '2020-03-23T00:00:00+0530', 77.1525, 79.785, 77.1525, 78.2525, 4814, 24819 ],
    [ '2020-03-24T00:00:00+0530', 78, 78.9, 77.88, 77.91, 10963, 25051 ],
    [ '2020-03-26T00:00:00+0530', 77.9, 77.9875, 76.9225, 77.1475, 1796, 24937 ],
    [ '2020-03-27T00:00:00+0530', 76.54, 77.4975, 76.15, 76.755, 15419, 20312 ],
    [ '2020-03-30T00:00:00+0530', 76.92, 77.15, 76.81, 76.96, 84, 20277 ],
    [ '2020-03-31T00:00:00+0530', 76.9, 76.95, 76.5, 76.675, 2089, 19885 ],
    [ '2020-04-03T00:00:00+0530', 77.44, 77.73, 77.1175, 77.6175, 1935, 20068 ],
    [ '2020-04-07T00:00:00+0530', 77.4, 77.4975, 77, 77.13, 523, 19808 ],
    [ '2020-04-08T00:00:00+0530', 77.4775, 77.7975, 77.1875, 77.7425, 3579, 18528 ],
    [ '2020-04-09T00:00:00+0530', 77.4775, 77.86, 77.405, 77.6225, 1255, 18963 ],
    [ '2020-04-13T00:00:00+0530', 77.5, 77.6625, 77.4175, 77.45, 2054, 18485 ],
    [ '2020-04-15T00:00:00+0530', 77.3, 77.765, 77.15, 77.73, 1061, 18467 ],
    [ '2020-04-16T00:00:00+0530', 77.8525, 78.1275, 77.7525, 78.09, 7489, 19557 ],
    [ '2020-04-17T00:00:00+0530', 77.9975, 77.9975, 77.4825, 77.6275, 4839, 20643 ],
    [ '2020-04-20T00:00:00+0530', 77.545, 77.8375, 77.545, 77.705, 1674, 20151 ],
    [ '2020-04-21T00:00:00+0530', 77.83, 78.17, 77.76, 78.1375, 1414, 20493 ],
    [ '2020-04-22T00:00:00+0530', 78.02, 78.1075, 77.65, 77.6925, 1159, 20580 ],
    [ '2020-04-23T00:00:00+0530', 77.6, 77.6, 77.0325, 77.2375, 1319, 20587 ],
    [ '2020-04-24T00:00:00+0530', 77.3175, 77.58, 77.2725, 77.405, 4186, 20002 ],
    [ '2020-04-27T00:00:00+0530', 77.265, 77.38, 77.15, 77.28, 1770, 19859 ],
    [ '2020-04-28T00:00:00+0530', 77.19, 77.435, 76.85, 76.875, 4346, 20155 ],
    [ '2020-04-29T00:00:00+0530', 76.8875, 77, 76.5225, 76.66, 11245, 26803 ],
    [ '2020-04-30T00:00:00+0530', 75.6, 76.6175, 75.6, 75.975, 7601, 27680 ],
    [ '2020-05-04T00:00:00+0530', 76.5975, 76.75, 76.52, 76.5825, 2890, 28634 ],
    [ '2020-05-05T00:00:00+0530', 76.45, 76.8, 76.4, 76.6725, 1263, 29124 ],
    [ '2020-05-06T00:00:00+0530', 76.655, 76.85, 76.57, 76.81, 9319, 29822 ],
    [ '2020-05-08T00:00:00+0530', 76.6, 76.6475, 76.2425, 76.5225, 4442, 29406 ],
    [ '2020-05-11T00:00:00+0530', 76.4375, 76.7375, 76.42, 76.715, 887, 29877 ],
    [ '2020-05-12T00:00:00+0530', 76.8025, 76.83, 76.135, 76.1875, 3900, 30464 ],
    [ '2020-05-13T00:00:00+0530', 76, 76.54, 75.9, 76.1825, 3437, 31193 ],
    [ '2020-05-14T00:00:00+0530', 76.3075, 76.4575, 76.24, 76.4175, 2366, 31621 ],
    [ '2020-05-15T00:00:00+0530', 76.34, 76.67, 76.27, 76.6475, 1165, 32139 ],
    [ '2020-05-18T00:00:00+0530', 76.51, 76.9, 76.5075, 76.8075, 2428, 33362 ],
    [ '2020-05-19T00:00:00+0530', 76.55, 76.8975, 76.4, 76.435, 4199, 32822 ],
    [ '2020-05-20T00:00:00+0530', 76.5975, 76.65, 76.3825, 76.51, 2388, 33895 ],
    [ '2020-05-21T00:00:00+0530', 76.6, 76.6, 76.2525, 76.295, 8650, 35289 ],
    [ '2020-05-22T00:00:00+0530', 76.4275, 76.7, 76.3675, 76.5975, 9445, 40893 ],
    [ '2020-05-26T00:00:00+0530', 76.4, 76.565, 76.315, 76.345, 6774, 44067 ],
    [ '2020-05-27T00:00:00+0530', 76.3125, 76.42, 76.2125, 76.3175, 37500, 60513 ],
    [ '2020-05-28T00:00:00+0530', 75.92, 76.54, 75.92, 76.45, 7862, 62279 ],
    [ '2020-05-29T00:00:00+0530', 76.3925, 76.3925, 76.12, 76.22, 10433, 62896 ],
    [ '2020-06-01T00:00:00+0530', 76.15, 76.22, 75.825, 76.185, 12841, 64890 ],
    [ '2020-06-02T00:00:00+0530', 76.2125, 76.25, 75.6725, 75.7675, 14754, 64507 ],
    [ '2020-06-03T00:00:00+0530', 75.65, 76.1375, 75.63, 76.1175, 12992, 68596 ],
    [ '2020-06-04T00:00:00+0530', 76, 76.225, 75.9625, 76.1625, 12131, 71346 ],
    [ '2020-06-05T00:00:00+0530', 76.1, 76.26, 75.9175, 76.2325, 14107, 75986 ],
    [ '2020-06-08T00:00:00+0530', 76.18, 76.2275, 75.98, 76.1125, 8718, 75425 ],
    [ '2020-06-09T00:00:00+0530', 76.2, 76.355, 75.95, 76.1575, 10315, 76711 ],
    [ '2020-06-10T00:00:00+0530', 75.905, 76.14, 75.905, 76.0725, 15332, 80333 ],
    [ '2020-06-11T00:00:00+0530', 76.01, 76.4, 76.01, 76.3075, 33396, 92759 ],
    [ '2020-06-12T00:00:00+0530', 76.5, 76.63, 76.305, 76.3775, 24138, 100724 ],
    [ '2020-06-15T00:00:00+0530', 76.49, 76.6775, 76.44, 76.6225, 41873, 105702 ],
    [ '2020-06-16T00:00:00+0530', 76.47, 76.8325, 76.3, 76.62, 37930, 109125 ],
    [ '2020-06-17T00:00:00+0530', 76.84, 76.87, 76.64, 76.7075, 27597, 115969 ],
    [ '2020-06-18T00:00:00+0530', 76.6825, 76.73, 76.58, 76.6225, 16364, 116769 ],
    [ '2020-06-19T00:00:00+0530', 76.75, 76.7975, 76.6525, 76.7, 29389, 113225 ],
    [ '2020-06-22T00:00:00+0530', 76.68, 76.72, 76.48, 76.505, 24624, 118316 ],
    [ '2020-06-23T00:00:00+0530', 76.32, 76.39, 76, 76.05, 39957, 126974 ],
    [ '2020-06-24T00:00:00+0530', 76.03, 76.2075, 75.9875, 76.065, 59417, 147201 ],
    [ '2020-06-25T00:00:00+0530', 76.1775, 76.2175, 75.99, 76.0425, 72912, 167100 ],
    [ '2020-06-26T00:00:00+0530', 76.005, 76.0825, 75.88, 76.0375, 97919, 192555 ],
    [ '2020-06-29T00:00:00+0530', 76.0725, 76.0975, 75.9125, 75.9225, 135909, 208653 ],
    [ '2020-06-30T00:00:00+0530', 75.9025, 76.035, 75.8575, 76.015, 182490, 217587 ],
    [ '2020-07-01T00:00:00+0530', 75.9325, 76.04, 75.9075, 76.0275, 81226, 224020 ],
    [ '2020-07-02T00:00:00+0530', 75.9, 75.9475, 75.0525, 75.1275, 352602, 278379 ],
    [ '2020-07-03T00:00:00+0530', 75.07, 75.4025, 74.95, 75.065, 275686, 304506 ],
    [ '2020-07-06T00:00:00+0530', 74.9825, 75.1975, 74.82, 75.005, 242211, 360140 ],
    [ '2020-07-07T00:00:00+0530', 75.03, 75.355, 75, 75.2675, 188656, 405585 ],
    [ '2020-07-08T00:00:00+0530', 75.2475, 75.46, 75.1825, 75.4125, 178125, 426120 ],
    [ '2020-07-09T00:00:00+0530', 75.4, 75.435, 75.2525, 75.3425, 157574, 470179 ],
    [ '2020-07-10T00:00:00+0530', 75.43, 75.69, 75.4225, 75.6, 225104, 528190 ],
    [ '2020-07-13T00:00:00+0530', 75.615, 75.615, 75.425, 75.5025, 155202, 567198 ],
    [ '2020-07-14T00:00:00+0530', 75.5975, 75.845, 75.595, 75.73, 289989, 635536 ],
    [ '2020-07-15T00:00:00+0530', 75.91, 75.98, 75.415, 75.455, 181948, 651971 ],
    [ '2020-07-16T00:00:00+0530', 75.4725, 75.6125, 75.4625, 75.5425, 163839, 663430 ],
    [ '2020-07-17T00:00:00+0530', 75.5175, 75.565, 75.2675, 75.29, 201727, 674424 ],
    [ '2020-07-20T00:00:00+0530', 75.1325, 75.365, 75.05, 75.0725, 267647, 721286 ],
    [ '2020-07-21T00:00:00+0530', 75.04, 75.155, 74.8975, 74.9275, 290645, 741785 ],
    [ '2020-07-22T00:00:00+0530', 74.9, 75.145, 74.8, 74.8475, 346424, 753956 ],
    [ '2020-07-23T00:00:00+0530', 74.875, 75.11, 74.8475, 75.065, 321526, 751659 ],
    [ '2020-07-24T00:00:00+0530', 75.0775, 75.21, 75.035, 75.08, 355998, 844942 ],
    [ '2020-07-27T00:00:00+0530', 74.8975, 75.1125, 74.8325, 75.03, 610704, 1000372 ],
    [ '2020-07-28T00:00:00+0530', 75.11, 75.115, 74.9125, 75.055, 1099309, 1296670 ],
    [ '2020-07-29T00:00:00+0530', 75.1, 75.29, 74.915, 74.9475, 1813670, 1549878 ],
    [ '2020-07-30T00:00:00+0530', 74.99, 75.125, 74.9425, 75.085, 1235361, 1541258 ],
    [ '2020-07-31T00:00:00+0530', 75.015, 75.085, 74.87, 75.0125, 1523639, 1543634 ],
    [ '2020-08-03T00:00:00+0530', 75.1, 75.49, 75.06, 75.445, 1645363, 1564016 ],
    [ '2020-08-04T00:00:00+0530', 75.36, 75.3975, 75.15, 75.2775, 1515052, 1593490 ],
    [ '2020-08-05T00:00:00+0530', 75.1, 75.2025, 74.8525, 75.015, 1600059, 1598332 ],
    [ '2020-08-06T00:00:00+0530', 75.015, 75.155, 74.92, 75.12, 1627573, 1577600 ],
    [ '2020-08-07T00:00:00+0530', 75.1225, 75.2475, 75.0425, 75.1125, 1271876, 1569905 ],
    [ '2020-08-10T00:00:00+0530', 75.2025, 75.2025, 74.99, 75.0775, 919833, 1493597 ],
    [ '2020-08-11T00:00:00+0530', 75, 75.02, 74.7075, 74.7925, 1332791, 1510710 ],
    [ '2020-08-12T00:00:00+0530', 74.815, 75.045, 74.815, 74.905, 1669693, 1386034 ],
    [ '2020-08-13T00:00:00+0530', 74.91, 75.015, 74.8625, 74.92, 1130387, 1355141 ],
    [ '2020-08-14T00:00:00+0530', 74.99, 75.06, 74.8325, 75.0175, 1486279, 1284512 ],
    [ '2020-08-17T00:00:00+0530', 74.9475, 74.9875, 74.865, 74.935, 943612, 1288278 ],
    [ '2020-08-18T00:00:00+0530', 74.8925, 74.95, 74.705, 74.7275, 1489430, 1332832 ],
    [ '2020-08-19T00:00:00+0530', 74.885, 74.9825, 74.695, 74.9025, 1465898, 1328648 ],
    [ '2020-08-20T00:00:00+0530', 74.9975, 75.175, 74.9775, 75.1525, 1436484, 1266678 ]
  ]
}";

            dynamic obj = Newtonsoft.Json.JsonConvert.DeserializeObject(response);
            dynamic candles = obj["candles"];
            List<Candle> cans = new List<Candle>();
            foreach(dynamic candle in candles)
            {
                dynamic fields = candle.ToString().Trim('[').Trim('[').Split(',');
                int index = 0;
                Candle can = new Candle();
                foreach (dynamic field in fields)
                {                    
                    if (index == 0)
                    {
                        string dateString = field.Trim('\r').Trim('\n').ToString();
                        dateString = dateString.Substring(3, dateString.Length - 4);
                        can.TimeStamp = DateTime.Parse(dateString);                       
                    }
                    if(index == 1)
                        can.Open = Decimal.Parse(field);
                    if (index == 2)
                        can.High = Decimal.Parse(field);
                    if (index == 3)
                        can.Low = Decimal.Parse(field);
                    if (index == 4)
                        can.Close = Decimal.Parse(field);
                    index++;
                }
                cans.Add(can);
            }
            return cans;
        }
    }

    class Data
    {
        public ChartData[] Candles { get; set; }
    }
    class ChartData
    {
        public List<Object> Fields { get; set; }
    }
}
